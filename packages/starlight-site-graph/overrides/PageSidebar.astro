---
import Default from "@astrojs/starlight/components/PageSidebar.astro";
import type { Props } from '@astrojs/starlight/props';
import config from 'virtual:starlight-site-graph/config'
import micromatch from 'micromatch';
import Graph from "../components/Graph.astro";

const graphData: {
    hidden?: boolean;
    depth?: number;
} | undefined = Astro.props.entry['data'].graph;


let showGraph: boolean;
if (graphData?.hidden !== undefined) {
    showGraph = graphData.hidden;
} else {
    showGraph = !config.hide_graph.some((pattern) => pattern === '' ? Astro.props.slug === '' : micromatch.isMatch(Astro.props.slug, pattern))
        || config.show_graph.some((pattern) => pattern === '' ? Astro.props.slug === '' : micromatch.isMatch(Astro.props.slug, pattern));
}
---

{showGraph &&
    <div class="right-sidebar-panel graph-panel">
        <h2>Graph View</h2>
        <Graph sitemap={config.sitemap} config={{
            ...config.graphConfig,
            depth: graphData?.depth ?? config.graphConfig.depth,
        }} />
    </div>
}

<Default {...Astro.props}>
    <slot />
</Default>
