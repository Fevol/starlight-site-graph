---
import Default from "@astrojs/starlight/components/PageSidebar.astro";
import type { Props } from '@astrojs/starlight/props';
import config from 'virtual:starlight-site-graph/config'
import Graph from "../components/Graph.astro";
import {firstMatchingPattern} from "../integrationUtil";
import {type PageGraphConfig} from "../schema";

const graphData: PageGraphConfig | undefined = Astro.props.entry['data'].graph;

let showGraph: boolean;
if (graphData?.visible !== undefined) {
    showGraph = graphData.visible;
} else {
    showGraph = config.graphConfig.visibilityRules ? firstMatchingPattern(Astro.props.slug, config.graphConfig.visibilityRules, false) : true;
}
---

{showGraph &&
    <div class="right-sidebar-panel graph-panel">
        <h2>Graph View</h2>
        <Graph sitemap={config.sitemapConfig.sitemap} config={{
            ...config.graphConfig,
            ...graphData
        }} />
    </div>
}

<Default {...Astro.props}>
    <slot />
</Default>
